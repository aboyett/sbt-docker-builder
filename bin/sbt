#!/usr/bin/env sh

set -e

SCRIPTS_DIR="/usr/local/bin"

if [ "${CI}" == "drone" ] ; then
    echo "Drone CI detected."
    export DETECTED_CI="drone"
    export CACHE_DIR="/drone"

elif [ "${CI}" == "true" -a "${GITLAB_CI}" == "true" ] ; then
    echo "Gitlab CI detected."
    export DETECTED_CI="gitlab-ci"
    export CACHE_DIR="${PWD}"
else
    echo "CI environment not detected. Running sbt without special preparation."
fi

if [ -n "$DETECTED_CI" ] ; then
    . ${SCRIPTS_DIR}/cache-init.sh
    . ${SCRIPTS_DIR}/credential-init.sh
fi

sbt-paulp $@
